<!DOCTYPE html>
<html layout:decorator="layouts/layout_default" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head lang="en">
    <title>Edit Policy</title>
    <script src="/js/lib/jquery.dataTables.min.js"
            th:src="@{/js/lib/jquery.dataTables.min.js}"></script>
    <script src="/js/lib/dataTables.bootstrap.min.js"
            th:src="@{/js/lib/dataTables.bootstrap.min.js}"></script>
    <link rel="stylesheet" href="/css/lib/dataTables.bootstrap3.css"
          th:href="@{/css/lib/dataTables.bootstrap3.css}"/>
    <link rel="stylesheet" th:href="@{/css/lib/bootstrap-multiselect.css}"/>
    <script th:src="@{/js/lib/bootstrap-multiselect.js}"/>
    <script th:src="@{/js/custom/admin/percentInfo.js?ver={version}(version=${appVersion.version})}"/>
    <script th:src="@{/js/custom/admin/policies/policies.js?ver={version}(version=${appVersion.version})}"/>
</head>
<body>
<div layout:fragment="content" id="searchResultContent">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <ol class="breadcrumb">
                    <li th:each="b : ${breadcrumb}">
                        <a th:href="@{${b.key}}" th:text="${b.value}" href="/vendors">Vendors</a>
                    </li>
                </ol>
            </div>
        </div>
        <h1 class="adminTitle">

            <a class=" btn btn-default" type="button" title="View policy matrix" style="margin-right: 10px;"
               th:href="@{/vendors/policyMatrix/showMatrix/{id}(id=${policyMeta.id})}">
                <span class="glyphicon glyphicon-th"></span>
            </a>Edit Policy
        </h1>


        <div class="row">
            <div class="col-md-12">
                <div class="alert alert-success alert-dismissible" role="alert" th:if="${successMessage}">
                    <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <span th:text="${successMessage}">successMessageKey</span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <form action="#" th:action="@{/vendors/policy/edit/{policyMetaId}(policyMetaId=${policyMeta.id})}" th:object="${policyMeta}" method="post">
                    <div class="alert alert-danger alert-dismissible" role="alert" th:if="${#fields.hasErrors('*')}">
                        <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <div th:each="e : ${#fields.detailedErrors()}">
                            <span th:text="${e.global}? '*' : ${e.fieldName}">The field name</span> |
                            <span th:text="${e.message}">The error message</span>
                        </div>
                    </div>
                    <div class="form-row row">
                        <div class="form-group col-sm-6">
                            <label for="displayName">Policy Display Name: </label>
                            <input id="displayName" type="text" th:field="*{displayName}"
                                   placeholder="Display Name" class="form-control"/>
                        </div>

                        <div class="form-group col-sm-6">
                            <label for="uniquecode">Policy Unique Code: </label>
                            <input id="uniquecode" type="text" th:field="*{uniqueCode}"
                                   placeholder="Unique Code" class="form-control"/>
                        </div>
                    </div>

                    <div class="form-row row">
                        <div class="form-group col-sm-6">
                            <label for="active">Policy Active: </label>
                            <select th:field="*{active}" id="active" class="form-control">
                                <option th:value="${'true'}" th:text="${'True'}"/>
                                <option th:value="${'false'}" th:text="${'False'}"/>
                            </select>
                        </div>

                        <div class="form-group col-sm-6">
                            <label for="purchasable">Policy Purchasable: </label>
                            <select th:field="*{purchasable}" id="purchasable" class="form-control">
                                <option th:value="${'true'}" th:text="${'True'}"/>
                                <option th:value="${'false'}" th:text="${'False'}"/>
                            </select>
                        </div>
                    </div>

                    <div class="form-row row">
                        <div class="form-group col-sm-6">
                            <label for="supportsZeroCancellation">Policy Supports Zero Cancellation: </label>
                            <select th:field="*{supportsZeroCancellation}" id="supportsZeroCancellation" class="form-control">
                                <option th:value="${'true'}" th:text="${'True'}"/>
                                <option th:value="${'false'}" th:text="${'False'}"/>
                            </select>
                            <!--
                            <input type="text" id="supportsZeroCancellation" th:field="*{supportsZeroCancellation}" class="form-control"/>
                            -->
                        </div>

                        <div class="form-group col-sm-6">
                            <label for="minTripCost">Minimal trip cost: </label>
                            <div id="showPageQuotes" class="divShowOnQuotesPage">
                                <input id="show" class="checkbox-custom" type="checkbox"/>
                                <label for="show" class="checkbox-custom-label showQuotesLabel">Show on quotes page </label>
                            </div>
                            <input id="minTripCost" type="text" th:field="*{minimalTripCost}"
                                   placeholder="Minimal trip cost" class="form-control"/>
                        </div>
                    </div>

                    <div class="form-row row">
                        <div class="form-group col-sm-6">
                            <label for="vendor.name">Policy Vendor: </label>
                            <input type="hidden" th:field="*{vendor.id}"/>
                            <input type="text" id="vendor.name" th:field="*{vendor.name}"
                                   readonly="readonly" class="form-control"/>
                        </div>

                        <div class="form-group col-sm-6" th:if="policyMetaPage">
                            <label for="policyMetaPage" style="padding-top: 6px;">Policy meta page:</label>
                            <p id="policyMetaPage" th:text="*{policyMetaPage.caption + ' (' + policyMetaPage.status + ')'}"/>
                        </div>
                    </div>

                    <input type="hidden" name="id" th:field="*{id}"/>
                    <input type="hidden" name="policyMetaPage" th:value="${policyMeta.policyMetaPage.id}"/>

                    <div class="form-row row">
                        <div class="form-group col-sm-6">
                            <a th:href="@{${backUrl}}" class="btn btn-default back-btn" style="padding: 6px 17px;">Back</a>
                            <button type="submit" class="btn btn-success" style="margin-left: 4px; padding: 6px 17px;">Save</button>
                        </div>

                        <div id="showOnQuotesPage" class="form-group col-sm-6 hiddenShowOnQuotesPage">
                        <label for="supportsZeroCancellation">Show on quotes page:</label>
                        <select th:field="*{showOnQuotes}" id="showOnQuotes" class="form-control">
                            <option th:value="${'true'}" th:text="${'True'}"/>
                            <option th:value="${'false'}" th:text="${'False'}"/>
                        </select>
                        </div>

                    </div>
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">

                <!-- Policy meta restriction modal-->
                <div th:replace="fragments/restrictions :: restrictionsFragment"></div>
                <!-- Policy meta restriction table-->
                <div th:replace="fragments/restrictionsTable :: restrictionsTableFragment"></div>
                <!-- Policy meta category-->
                <hr/>
                <div>
                    <div class="modal fade" id="chooseCategoryDialog" tabindex="-1" role="dialog" style="color: black;" aria-labelledby="chooseCategoryDialogLabel">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="chooseCategoryDialogLabel">Choose category.</h4>
                                </div>
                                <div class="modal-body">
                                    <select id="categoryCode" class="form-control">
                                        <option th:each="category : ${categories}"
                                                th:value="${category.code}" th:text="${category.name}"/>
                                    </select>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                    <a href="" class="btn btn-primary" onclick="createPolicyMetaCategory(); return false;">Create Policy Meta Category</a>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="row">
                        <div class="col-md-8"><h2>Policy meta category</h2></div>
                        <div class="col-md-4 text-right">
                            <h2><a class="btn btn-success xcrud-action" onclick="openChooseCategoryDialog(); return false;">
                                <i class="glyphicon glyphicon-plus-sign"></i>&nbsp;&nbsp;Create</a></h2>
                        </div>
                    </div>
                    <div class="overflowXMD">
                        <table class="table table-hover table-bordered" id="metaCategory">
                            <thead>
                            <tr class="info">
                                <th> Description</th>
                                <th> Type</th>
                                <th> Category</th>
                                <th> Values</th>
                                <th style="width: 8%"> Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="policyMetaCategory : ${policyMeta.policyMetaCategories}" th:id="'policyMetaCategory-' + ${policyMetaCategory.id}">
                                <td th:text="${policyMetaCategory.description}"/>
                                <td th:text="${policyMetaCategory.type}"/>
                                <td th:text="${policyMetaCategory.category.name}"/>
                                <td>
                                    <div th:each="categoryVal : ${policyMetaCategory.values}" style="white-space: nowrap">
                                        <span th:text="${categoryVal.caption}"></span>
                                        (<span
                                            th:text="${categoryVal.value} + ' ' + ${categoryVal.valueType.shortCaption}"></span>)
                                        <span th:if="${policyMetaCategory.category.code == 'pre-ex-waiver'
                                                        or policyMetaCategory.category.code=='cancel-for-any-reason'
                                                        or policyMetaCategory.category.code=='cancel-for-work-reasons'
                                                        or policyMetaCategory.category.code=='pre-ex-waiver-on-trip'}">
                                            <br/>
                                            <span th:if="${categoryVal.daysAfterInitialDeposit != null}"
                                                  th:text="'d after dep:' + ${categoryVal.daysAfterInitialDeposit} + ', '"></span>
                                            <span th:if="${categoryVal.daysAfterFinalPayment != null}"
                                                  th:text="'final pay:' + ${categoryVal.daysAfterFinalPayment}+ ', '"></span>
                                            <span th:if="${categoryVal.minAge != null or categoryVal.maxAge != null}"
                                                  th:text="'min-max age:' + ${categoryVal.minAge != null ? categoryVal.minAge : '-1'} + '-' + ${categoryVal.maxAge != null ? categoryVal.maxAge : '999'}"></span>
                                        </span>
                                    </div>
                                </td>
                                <td>
                                    <a class="pull-left btn btn-primary" type="button" title="Edit"
                                       th:href="@{/vendors/policy/metaCategory/edit/{id}(id=${policyMetaCategory.id})}">
                                        <span class="glyphicon glyphicon-edit"></span>
                                    </a>
                                    <button class="pull-right btn btn-danger" type="button" title="Delete"
                                            th:onclick="'javascript:deletePolicyMetaCategory(\'' + ${policyMetaCategory.id} + '\');'">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>


                <!-- Policy meta package-->
                <hr/>
                <div>
                    <div class="row">
                        <div class="col-md-8"><h2>Policy meta package</h2></div>
                        <div class="col-md-4 text-right">
                            <a th:href="@{/vendors/policy/policyMetaPackage/create/{id}(id=${policyMeta.id})}" class="btn btn-success xcrud-action "><i
                                    class="glyphicon glyphicon-plus-sign"></i>&nbsp;&nbsp;Create</a>
                        </div>
                    </div>
                    <div class="overflowXMD">
                        <table class="table table-hover table-bordered" id="policyMetaPackagesTable">
                            <thead>
                            <tr class="info">
                                <th>Name</th>
                                <th width="9%">Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="policyMetaPackage : ${policyMetaPackages}" th:id="'policyMetaPackage-' + ${policyMetaPackage.id}">
                                <td th:text="${policyMetaPackage.name}"></td>
                                <td>
                                    <a class="pull-left btn btn-primary" type="button" title="Edit"
                                       th:href="@{/vendors/policy/policyMetaPackage/edit/{id}(id=${policyMetaPackage.id})}">
                                        <span class="glyphicon glyphicon-edit"></span>
                                    </a>
                                    <button class="pull-right btn btn-danger" type="button" title="Delete"
                                            th:onclick="'javascript:deletePolicyMetaPackage(\'' + ${policyMetaPackage.id} + '\');'">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <hr/>

                <div data-toggle="collapse" data-target="#ts" aria-expanded="true">
                    <div class="row">
                        <div class="col-md-8"><h2><span style="color:#d9534f">Technical settings</span></h2></div>
                    </div>
                </div>

                <div id="ts" class="collapse">
                    <!-- Policy meta code-->
                    <div>
                        <div class="row">
                            <div class="col-md-8"><h2>Policy meta code <span style="color:#d9534f">(Technical settings only)</span> </h2></div>
                            <div class="col-md-4 text-right">
                                <a th:href="@{/vendors/policy/policyMetaCode/create/{id}(id=${policyMeta.id})}" class="btn btn-success xcrud-action "><i
                                        class="glyphicon glyphicon-plus-sign"></i>&nbsp;&nbsp;Create</a>
                            </div>
                        </div>
                        <div class="overflowXMD">
                            <table class="table table-hover table-bordered" id="policyMetaCodesTable">
                                <thead>
                                <tr class="info">
                                    <th>Name</th>
                                    <th>Code</th>
                                    <th width="8%">Actions</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="policyMetaCode : ${policyMeta.policyMetaCodes}" th:id="'policyMetaCode-' + ${policyMetaCode.id}">
                                    <td th:text="${policyMetaCode.name}"/>
                                    <td th:text="${policyMetaCode.code}"/>
                                    <td>
                                        <a class="pull-left btn btn-primary" type="button" title="Edit"
                                           th:href="@{/vendors/policy/policyMetaCode/edit/{id}(id=${policyMetaCode.id})}">
                                            <span class="glyphicon glyphicon-edit"></span>
                                        </a>
                                        <button class="pull-right btn btn-danger" type="button" title="Delete"
                                                th:onclick="'javascript:deletePolicyMetaCode(\'' + ${policyMetaCode.id} + '\');'">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <hr />
                    <!-- Policy quote params-->

                    <div>
                        <div class="row">
                            <div class="col-md-8"><h2>Policy quote params <span style="color:#d9534f">(Technical settings only)</span></h2></div>
                            <div class="col-md-4 text-right">
                                <h2><a th:href="@{/vendors/policy/quoteParam/create/{id}(id=${policyMeta.id})}" class="btn btn-success xcrud-action "><i
                                        class="glyphicon glyphicon-plus-sign"></i>&nbsp;&nbsp;Create</a></h2>
                            </div>
                        </div>
                        <div class="overflowXMD">
                            <table class="table table-hover table-bordered" id="quoteParam">
                                <thead>
                                <tr class="info">
                                    <th width="17%"> Value</th>
                                    <th width="15%"> param 1</th>
                                    <th width="15%"> param 2</th>
                                    <th width="15%"> param 3</th>
                                    <th width="15%"> param 4</th>
                                    <th width="15%"> param 5</th>
                                    <th width="15%"> Actions</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="policyQuoteParam : ${policyMeta.policyQuoteParams}" th:id="'policyQuoteParam-' + ${policyQuoteParam.id}">
                                    <td th:text="${policyQuoteParam.value}"/>
                                    <td>
                                        <div th:if="${policyQuoteParam.param1 != null}">
                                        <span th:if="${policyQuoteParam.param1.type.name() == 'SIMPLE'}"
                                              th:text="${policyQuoteParam.param1.valueFrom}"/>
                                            <span th:if="${policyQuoteParam.param1.type.name() == 'RANGE'}"
                                                  th:text="${policyQuoteParam.param1.valueFrom+' - '+policyQuoteParam.param1.valueTo}"/>
                                        </div>
                                    </td>
                                    <td>
                                        <div th:if="${policyQuoteParam.param2 != null}">
                                        <span th:if="${policyQuoteParam.param2.type.name() == 'SIMPLE'}"
                                              th:text="${policyQuoteParam.param2.valueFrom}"/>
                                            <span th:if="${policyQuoteParam.param2.type.name() == 'RANGE'}"
                                                  th:text="${policyQuoteParam.param2.valueFrom+'-'+policyQuoteParam.param2.valueTo}"/>
                                        </div>
                                    </td>
                                    <td>
                                        <div th:if="${policyQuoteParam.param3 != null}">
                                        <span th:if="${policyQuoteParam.param3.type.name() == 'SIMPLE'}"
                                              th:text="${policyQuoteParam.param3.valueFrom}"/>
                                            <span th:if="${policyQuoteParam.param3.type.name() == 'RANGE'}"
                                                  th:text="${policyQuoteParam.param3.valueFrom+'-'+policyQuoteParam.param3.valueTo}"/>
                                        </div>
                                    </td>
                                    <td>
                                        <div th:if="${policyQuoteParam.param4 != null}">
                                        <span th:if="${policyQuoteParam.param4.type.name() == 'SIMPLE'}"
                                              th:text="${policyQuoteParam.param4.valueFrom}"/>
                                            <span th:if="${policyQuoteParam.param4.type.name() == 'RANGE'}"
                                                  th:text="${policyQuoteParam.param4.valueFrom+'-'+policyQuoteParam.param4.valueTo}"/>
                                        </div>
                                    </td>
                                    <td>
                                        <div th:if="${policyQuoteParam.param5 != null}">
                                        <span th:if="${policyQuoteParam.param5.type.name() == 'SIMPLE'}"
                                              th:text="${policyQuoteParam.param5.valueFrom}"/>
                                            <span th:if="${policyQuoteParam.param5.type.name() == 'RANGE'}"
                                                  th:text="${policyQuoteParam.param5.valueFrom+'-'+policyQuoteParam.param5.valueTo}"/>
                                        </div>
                                    </td>
                                    <td>
                                        <a class="pull-left btn btn-primary" type="button" title="Edit"
                                           th:href="@{/vendors/policy/quoteParam/edit/{id}(id=${policyQuoteParam.id})}">
                                            <span class="glyphicon glyphicon-edit"></span>
                                        </a>
                                        <button class="pull-right btn btn-danger" type="button" title="Delete"
                                                th:onclick="'javascript:deleteQuoteParam(\'' + ${policyQuoteParam.id} + '\');'">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script th:inline="javascript">
        // @formatter:off
        /*<![CDATA[*/
        var policyMetaId = [[${policyMeta.id}]];
        /*]]>*/
        // @formatter:on
    </script>
    <script type="application/javascript">
        function openChooseCategoryDialog() {
            $('#chooseCategoryDialog').modal('show');
        }
        function createPolicyMetaCategory() {
            window.location.href = context + "vendors/policy/metaCategory/create/" + policyMetaId + "/" + $('#categoryCode').val();
        }
    </script>
</div>
</body>
</html>